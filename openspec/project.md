# Project Context: axios-ai-mail

## Purpose
A declarative, web-based email organizer with local AI classification. Provides a privacy-first email management experience that leverages local LLMs for intelligent organization, designed for NixOS and Home Manager users.

## Tech Stack
- **Backend**: Python with FastAPI, SQLAlchemy, Alembic
- **Frontend**: React with TypeScript, Material-UI, Vite
- **Database**: SQLite with full-text search
- **AI Engine**: Ollama (local LLMs like llama3.2 or mistral)
- **Email Providers**: Gmail API (OAuth2), IMAP (password-based)
- **Real-Time**: WebSockets for live updates
- **Deployment**: Nix Flake with NixOS/Home-Manager modules
- **Secret Management**: Integration with agenix/sops-nix

## Project Conventions

### Code Style
- **Python**: PEP 8, formatted with Black/Ruff. Type hints are required.
- **TypeScript**: ESLint with React rules. Strict type checking enabled.
- **Naming**: `snake_case` for Python, `camelCase` for TypeScript.

### Architecture Patterns
- **Declarative Configuration**: Nix module generates runtime config.
- **Provider Abstraction**: Base provider class with Gmail/IMAP implementations.
- **Event-Driven Sync**: Background sync with WebSocket notifications.
- **SQLite-Centric**: Database is source of truth for all mail state.
- **Separation of Concerns**: API, Sync, Classification, and UI are independent.

### Testing Strategy
- **Validation**: `openspec validate` for all architectural changes.
- **API Tests**: pytest with FastAPI test client.
- **Frontend Tests**: Vitest for React components.

### Git Workflow
- **Spec-First**: Use OpenSpec workflow for all new features and changes.
- **Commit Messages**: Conventional commits.

## Domain Context
- **Nix-Centric Integration**: Designed for Home-Manager or NixOS modules. Email accounts defined as Nix options.
- **Privacy-First**: Local AI processing, no cloud dependencies.
- **Multi-Provider**: Unified interface for Gmail and generic IMAP.
- **PWA Support**: Installable as desktop/mobile progressive web app.

## Important Constraints
- **Local AI Only**: No cloud LLMs; must run via Ollama or similar local backends.
- **OAuth2 Security**: Gmail uses OAuth2; IMAP passwords stored in encrypted files.
- **Idempotency**: Config generation and sync operations must be idempotent.
- **Responsive Design**: Web UI must work on both desktop and mobile devices.

## External Dependencies
- `ollama` - Local LLM runtime
- `agenix` or `sops-nix` - Secret management
- Google Cloud OAuth credentials (for Gmail)
